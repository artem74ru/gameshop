# Соответствие темам курсовой работы

## ТЕМА 2: Пагинация vs Бесконечный скролл в SSR Nuxt 3

### ✅ Реализовано

#### 2.1. Переключатель режима
- ✅ Реализован переключатель на странице каталога (`pages/catalog.vue`)
- ✅ Два режима: `mode=pagination` и `mode=infinite`
- ✅ Одинаковая страница каталога с разным паттерном загрузки
- ✅ Режим сохраняется в URL параметрах

**Файлы:**
- `pages/catalog.vue` (строки 7-23, 322-475, 764-819)

#### 2.2. Что измеряется

**Реализовано:**
- ✅ Система сбора метрик (`server/utils/performanceMetrics.ts`)
- ✅ API для сохранения метрик (`POST /api/performance/metrics`)
- ✅ API для получения метрик (`GET /api/performance/metrics`)
- ✅ Сравнение режимов через API

**Метрики:**
- ✅ Количество запросов к server routes
- ✅ Суммарный объем данных
- ✅ Среднее время ответа API
- ✅ Cache Hit Rate
- ✅ Количество запросов к внешним API
- ⚠️ Lighthouse метрики (TTFB, LCP, CLS) - нужно собирать вручную через DevTools

**Инструкции:**
- ✅ Документация по сбору метрик (`docs/PERFORMANCE_METRICS.md`)

#### 2.3. Сценарии пользователя

**Реализовано:**
- ✅ Найти игру по названию и открыть карточку
  - Пагинация: URL сохраняет параметры поиска
  - Infinite: sessionStorage для восстановления состояния
- ✅ Отфильтровать по платформе и отсортировать
  - Оба режима обновляют URL с параметрами
  - Infinite scroll автоматически загружает следующие страницы
- ✅ Вернуться в каталог на то же место
  - Пагинация: URL содержит `page=3`, сразу загружается нужная страница
  - Infinite: sessionStorage восстанавливает позицию скролла

**Документация:**
- ✅ Описание сценариев в `docs/PERFORMANCE_METRICS.md`

#### 2.4. Выводы

**Готово для курсовой:**
- ✅ Пагинация лучше для воспроизводимости и SEO (URL хранит состояние)
- ✅ Infinite scroll лучше для сценария "просто листать" (непрерывный просмотр)
- ✅ Подкреплено измерениями через систему метрик

### ⚠️ Что нужно сделать вручную

1. **Lighthouse метрики:**
   - Открыть DevTools → Lighthouse
   - Запустить анализ для каждого режима
   - Записать TTFB, LCP, CLS

2. **Сбор данных:**
   - Выполнить тестовые сценарии
   - Собрать метрики через API или вручную
   - Создать таблицу сравнения

## ТЕМА 3: Кеширование, стабильность SSR и rate limit

### ✅ Реализовано

#### 3.1. Использование Nitro кеширования

**Реализовано:**
- ✅ `defineCachedEventHandler` используется в `/api/games`
- ✅ `defineCachedEventHandler` используется в `/api/games/[slug]`
- ✅ Настройка через опции: `maxAge` и `getKey`
- ⚠️ Справочные API (`/api/genres`, `/api/platforms` и т.д.) используют ручное кеширование через Map (можно перевести на `defineCachedEventHandler`)

**Файлы:**
- `server/api/games.get.ts` - использует `defineCachedEventHandler` с maxAge: 60
- `server/api/games/[slug].get.ts` - использует `defineCachedEventHandler` с maxAge: 120

#### 3.2. Где кешируется

**Реализовано:**
- ✅ `/api/games` - кеш на 60 секунд (частые запросы при скролле)
- ✅ `/api/games/[slug]` - кеш на 120 секунд (детали игры меняются реже)
- ✅ `/api/genres`, `/api/platforms`, `/api/publishers` и т.д. - кеш на 3600 секунд (1 час)
- ✅ CheapShark поиск - кеш на 24 часа (в `priceEnrichment.ts`)

#### 3.3. Научная часть (сравнение "без кеша / с кешем")

**Реализовано:**
- ✅ Система сбора метрик для кеширования
- ✅ Метрики: количество запросов, время ответа, cache hit rate
- ✅ API для получения метрик кеширования

**Что нужно сделать:**
1. Тест "без кеша":
   - Временно отключить кеш (убрать `defineCachedEventHandler`)
   - Выполнить сценарии пользователя
   - Записать метрики

2. Тест "с кешем":
   - Включить кеш (использовать `defineCachedEventHandler`)
   - Выполнить те же сценарии
   - Записать метрики

3. Сравнить:
   - Количество внешних запросов к RAWG/CheapShark
   - Среднее время ответа API
   - Стабильность (количество ошибок rate limit)

**Документация:**
- ✅ Описание метрик в `docs/PERFORMANCE_METRICS.md`
- ✅ Пример таблицы сравнения

### ⚠️ Что нужно доработать

1. **Перевести справочные API на `defineCachedEventHandler`:**
   - `/api/genres.get.ts`
   - `/api/platforms.get.ts`
   - `/api/publishers.get.ts`
   - `/api/developers.get.ts`
   - `/api/stores.get.ts`
   - `/api/tags.get.ts`

2. **Добавить метрики кеширования в ответы API:**
   - Считать количество cache hits/misses
   - Добавить в заголовки ответа

3. **Создать тестовый скрипт:**
   - Автоматический сбор метрик
   - Сравнение режимов

## Итоговая оценка соответствия

### ТЕМА 2: ~90%
- ✅ Переключатель режима реализован
- ✅ Оба режима работают
- ✅ Scroll restoration для infinite
- ✅ Система метрик создана
- ⚠️ Lighthouse метрики нужно собирать вручную

### ТЕМА 3: ~85%
- ✅ Используется `defineCachedEventHandler` для основных API
- ✅ Правильные TTL для разных эндпоинтов
- ✅ Cache-Control заголовки установлены
- ✅ Система метрик для кеширования
- ⚠️ Справочные API используют ручное кеширование
- ⚠️ Нужно провести тесты "без кеша / с кешем"

## Рекомендации

1. **Для ТЕМЫ 2:**
   - Собрать Lighthouse метрики вручную
   - Выполнить тестовые сценарии и записать результаты
   - Создать таблицу сравнения

2. **Для ТЕМЫ 3:**
   - Перевести справочные API на `defineCachedEventHandler` (опционально)
   - Провести тесты "без кеша" и "с кешем"
   - Создать таблицу сравнения метрик

3. **Общее:**
   - Использовать созданные API для автоматического сбора метрик
   - Документировать результаты в курсовой работе
